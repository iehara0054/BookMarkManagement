# 絞り込み検索ガイド

## 1. JSONデータの準備 (data.json)

```json
[
    {
        "id": 1,
        "name": "Apple",
        "category": "Fruit"
    },
    {
        "id": 2,
        "name": "Banana",
        "category": "Fruit"
    },
    {
        "id": 3,
        "name": "Carrot",
        "category": "Vegetable"
    },
    {
        "id": 4,
        "name": "Dog",
        "category": "Animal"
    }
]
```

## 2. PHPスクリプト (search.php) での絞り込み実装

ユーザーからの検索入力を受け取り、`array_filter`を使用して絞り込みを行います。

```php
<?php
// 検索キーワードを取得 (例: フォームからのGETリクエスト)
$searchTerm = isset($_GET['search']) ? $_GET['search'] : '';
$searchTerm = strtolower($searchTerm); // 小文字に変換して検索しやすくする

// 1. JSONファイルを読み込み、PHPのデータ構造にデコードする
$jsonData = file_get_contents('data.json');
// json_decodeの第二引数をtrueにすると連想配列に、false(デフォルト)だとオブジェクトになる
$items = json_decode($jsonData, true);

// デコード失敗時のエラーハンドリング
if ($items === null && json_last_error() !== JSON_ERROR_NONE) {
    die("JSONデータの読み込みに失敗しました。");
}

// 2. 絞り込み処理
$filteredItems = array_filter($items, function ($item) use ($searchTerm) {
    // 検索条件に合うかどうかをチェック
    // nameまたはcategoryに検索キーワードが含まれているかを部分一致で確認
    return str_contains(strtolower($item['name']), $searchTerm) ||
           str_contains(strtolower($item['category']), $searchTerm);
});

// 3. 絞り込まれた結果を新しいJSON形式で出力(またはHTMLで表示)
header('Content-Type: application/json');
echo json_encode(array_values($filteredItems), JSON_PRETTY_PRINT); // キーを振り直して整形して出力
?>
```

## ポイント

- **`json_decode()`**: JSON形式の文字列をPHPの変数(配列またはオブジェクト)に変換します。
- **`array_filter()`**: 配列の各要素に対してコールバック関数を適用し、条件を満たす要素のみを抽出した新しい配列を返します。
- **`str_contains()`**: PHP 8.0以降で使用可能な、文字列内に特定の文字列が含まれているかを判定する関数です。
- **エラーハンドリング**: `json_decode`が失敗した場合に備え、戻り値が`null`でないか、または`json_last_error()`でエラーを確認することが重要です。
